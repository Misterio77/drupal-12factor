#!/usr/bin/env bash

# Simple wrapper to run drush
# It also sets DRUPAL_DATA_PATH if needed, and cd's into the project root

set -euo pipefail
export DRUPAL_DATA_PATH="$(realpath "${DRUPAL_DATA_PATH:-$(pwd)/data}")"
export DRUPAL_PROJECT_ROOT="$(realpath "${DRUPAL_PROJECT_ROOT:-$(dirname $(dirname -- "$0"))}")"
echo >&2 "Using data path '$DRUPAL_DATA_PATH'"
echo >&2 "Using project root '$DRUPAL_PROJECT_ROOT'"

if ! [ -f "$DRUPAL_PROJECT_ROOT/vendor/bin/drush" ]; then
  echo >&2 "Drush is not installed. Try running 'composer install' first."
  exit 1
fi

"$DRUPAL_PROJECT_ROOT/vendor/bin/drush" --root="$DRUPAL_PROJECT_ROOT" "$@"
